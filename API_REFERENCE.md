# API Reference: podfeedfilter

*Generated by AI evaluation on 2025-08-29*

## Overview

This document provides comprehensive API documentation for the **podfeedfilter** package, including all public functions, classes, and command-line interfaces.

## Module: `podfeedfilter`

### Package Information

```python
"""Podcast feed filtering and splitting tool.

This package provides functionality to download RSS podcast feeds,
filter episodes based on include/exclude keywords, and generate custom
output feeds. Supports splitting single feeds into multiple filtered
outputs for targeted episode organization.
"""
```

---

## Module: `podfeedfilter.config`

### Functions

#### `load_config(path: str) -> List[FeedConfig]`

Parse a YAML configuration file into a list of FeedConfig objects.

**Parameters:**
- `path` (str): Path to the YAML configuration file

**Returns:**
- `List[FeedConfig]`: List of parsed feed configuration objects, including expanded splits

**Raises:**
- `FileNotFoundError`: If configuration file doesn't exist
- `yaml.YAMLError`: If YAML syntax is invalid
- `KeyError`: If required configuration keys are missing

**Example:**
```python
from podfeedfilter.config import load_config

feeds = load_config('feeds.yaml')
for feed in feeds:
    print(f"Processing {feed.url} -> {feed.output}")
```

### Classes

#### `class FeedConfig`

Dataclass representing configuration for a single podcast feed filtering task.

```python
@dataclass
class FeedConfig:
    """Configuration for a single podcast feed filtering task."""
    
    url: str                                        # Source RSS feed URL (required)
    output: str                                     # Output file path (required)
    include: List[str] = field(default_factory=list)  # Include keywords (optional)
    exclude: List[str] = field(default_factory=list)  # Exclude keywords (optional)
    title: str | None = None                        # Override feed title (optional)
    description: str | None = None                  # Override feed description (optional)
    check_modified: bool = True                     # Enable HTTP caching (optional)
    private: bool = True                            # Add iTunes block tag (optional)
```

**Attributes:**

| Attribute | Type | Default | Description |
|-----------|------|---------|-------------|
| `url` | `str` | *Required* | Source RSS feed URL to fetch and filter |
| `output` | `str` | *Required* | File path where filtered RSS will be written |
| `include` | `List[str]` | `[]` | Keywords that must be present in episode (empty = no filter) |
| `exclude` | `List[str]` | `[]` | Keywords that must not be present in episode (empty = no filter) |
| `title` | `str \| None` | `None` | Override the source feed's title in output |
| `description` | `str \| None` | `None` | Override the source feed's description in output |
| `check_modified` | `bool` | `True` | Enable HTTP conditional requests for bandwidth optimization |
| `private` | `bool` | `True` | Add iTunes block tag to prevent podcast directory indexing |

**Usage Examples:**

```python
# Simple filtering configuration
config = FeedConfig(
    url="https://example.com/feed.rss",
    output="filtered.xml",
    exclude=["politics", "advertisement"]
)

# Advanced configuration with custom metadata
config = FeedConfig(
    url="https://example.com/feed.rss",
    output="tech_episodes.xml",
    include=["python", "programming", "technology"],
    title="Tech Episodes Only",
    description="Filtered technology episodes",
    private=False  # Public feed
)
```

---

## Module: `podfeedfilter.filterer`

### Functions

#### `process_feed(cfg: FeedConfig, no_check_modified: bool = False) -> None`

Process a single feed: download, filter, and generate output feed.

**Parameters:**
- `cfg` (FeedConfig): Feed configuration object
- `no_check_modified` (bool, optional): Disable HTTP conditional requests. Defaults to `False`.

**Returns:**
- `None`

**Side Effects:**
- Creates/updates output RSS file
- May update file timestamp to match server's Last-Modified header
- Prints warnings for network failures (with fallback)

**Example:**
```python
from podfeedfilter.config import FeedConfig
from podfeedfilter.filterer import process_feed

config = FeedConfig(
    url="https://example.com/feed.rss",
    output="filtered.xml",
    include=["python"]
)

process_feed(config)  # Creates filtered.xml with Python episodes
```

#### `_text_matches(text: str, keywords: list[str]) -> bool`

Check if text contains any of the specified keywords (case-insensitive).

**Parameters:**
- `text` (str): Text to search within
- `keywords` (list[str]): List of keywords to search for

**Returns:**
- `bool`: `True` if any keyword is found, `False` otherwise

**Example:**
```python
result = _text_matches("Python Programming Tutorial", ["python", "java"])
# Returns: True (matches "python")

result = _text_matches("Hello World", ["goodbye"])
# Returns: False (no matches)
```

#### `_entry_passes(entry: feedparser.FeedParserDict, include: list[str], exclude: list[str]) -> bool`

Determine if a feed entry passes the include/exclude filter criteria.

**Parameters:**
- `entry` (feedparser.FeedParserDict): Parsed RSS entry from feedparser
- `include` (list[str]): Keywords that must be present (empty = no filter)
- `exclude` (list[str]): Keywords that must not be present (empty = no filter)

**Returns:**
- `bool`: `True` if entry passes filters, `False` otherwise

**Filter Logic:**
1. If `exclude` keywords are provided and any match: **FAIL**
2. If `include` keywords are provided and none match: **FAIL**
3. Otherwise: **PASS**

**Text Sources:** 
The function searches within: `entry.title + entry.description + entry.summary`

**Example:**
```python
entry = {
    'title': 'Python Programming Tutorial',
    'description': 'Learn Python basics',
    'summary': 'Beginner-friendly guide'
}

# Include filter example
result = _entry_passes(entry, include=['python'], exclude=[])
# Returns: True (contains "python")

# Exclude filter example  
result = _entry_passes(entry, include=[], exclude=['advanced'])
# Returns: True (doesn't contain "advanced")

# Combined filters example
result = _entry_passes(entry, include=['python'], exclude=['advanced'])
# Returns: True (contains "python" and doesn't contain "advanced")
```

#### `_conditional_fetch(url: str, since: float | None) -> tuple[bytes | None, float | None]`

Fetch URL with HTTP conditional request using If-Modified-Since header.

**Parameters:**
- `url` (str): URL to fetch
- `since` (float | None): Unix timestamp for If-Modified-Since header, or None

**Returns:**
- `tuple[bytes | None, float | None]`: 
  - `(content_bytes, last_modified_timestamp)` if content was modified
  - `(None, None)` if content was not modified (304 response)

**Raises:**
- `requests.RequestException`: For network/HTTP errors
- `ValueError`: For invalid timestamp parsing

**HTTP Behavior:**
- Uses 30-second timeout
- Sends `If-Modified-Since` header when `since` is provided
- Returns `(None, None)` on 304 Not Modified response
- Parses `Last-Modified` header from response

**Example:**
```python
# First fetch (no conditional)
content, timestamp = _conditional_fetch("https://example.com/feed.rss", None)

# Subsequent fetch (conditional)
content, timestamp = _conditional_fetch("https://example.com/feed.rss", timestamp)
if content is None:
    print("Feed hasn't changed since last fetch")
```

#### `_copy_entry(fe, entry: feedparser.FeedParserDict) -> None`

Copy relevant fields from a parsed RSS entry into a feedgen entry object.

**Parameters:**
- `fe`: FeedGen entry object (from feedgen library)
- `entry` (feedparser.FeedParserDict): Parsed RSS entry from feedparser

**Returns:**
- `None`

**Side Effects:**
- Modifies the `fe` (feedgen entry) object by copying fields from `entry`

**Fields Copied:**
- `id` (uses `entry.id` or `entry.link` as fallback)
- `title`
- `link` 
- `description` (uses `entry.summary` or `entry.description`)
- `published`
- `author`
- `content` (all content elements)
- `enclosures` (all enclosure elements)

**Error Handling:**
- Gracefully handles missing fields (skips them)
- Handles malformed enclosure data
- Uses fallbacks where appropriate (e.g., link for missing id)

---

## Module: `podfeedfilter.__main__`

### Functions

#### `main() -> None`

Main entry point for command-line execution.

**Parameters:**
- None (reads from `sys.argv`)

**Returns:**
- `None`

**Side Effects:**
- Processes all configured feeds
- Prints warnings/errors to stdout
- Creates/updates output RSS files

**Command Line Arguments:**

| Argument | Short | Type | Default | Description |
|----------|-------|------|---------|-------------|
| `--config` | `-c` | `str` | `"feeds.yaml"` | Path to configuration file |
| `--no-check-modified` | `-n` | `bool` | `False` | Disable HTTP conditional requests |
| `--private` | `-p` | `str` | `None` | Override private setting (`"true"`/`"false"`) |

**Example Usage:**
```bash
# Use default configuration
python -m podfeedfilter

# Custom configuration file
python -m podfeedfilter -c my_feeds.yaml

# Force refresh (ignore caching)
python -m podfeedfilter -c feeds.yaml --no-check-modified

# Override all feeds to be public
python -m podfeedfilter -c feeds.yaml --private false
```

---

## Configuration File Format

### YAML Structure

```yaml
feeds:
  - url: "https://example.com/feed.rss"        # Required: Source feed URL
    output: "filtered.xml"                     # Required: Output file path
    include: ["keyword1", "keyword2"]          # Optional: Include keywords
    exclude: ["keyword3", "keyword4"]          # Optional: Exclude keywords
    title: "Custom Feed Title"                 # Optional: Override feed title
    description: "Custom description"          # Optional: Override description
    check_modified: true                       # Optional: Enable caching (default: true)
    private: true                              # Optional: Privacy setting (default: true)
    
    # Optional: Feed splitting (one source → multiple outputs)
    splits:
      - output: "split1.xml"                   # Required: Split output file
        title: "Split Feed 1"                  # Optional: Split-specific title
        description: "First split"             # Optional: Split-specific description
        include: ["split1_keyword"]            # Optional: Split-specific includes
        exclude: ["split1_exclude"]            # Optional: Split-specific excludes
        private: false                         # Optional: Split-specific privacy
        check_modified: true                   # Optional: Inherit or override parent
```

### Configuration Inheritance

**Feed Splits Inheritance Rules:**
- `url`: Always inherited from parent feed
- `check_modified`: Inherits from parent unless explicitly overridden
- `private`: Defaults to `True` unless explicitly set
- `title`, `description`, `include`, `exclude`: Independent per split

### Type Coercion

**Boolean Fields** (`private`, `check_modified`):
- `true`, `True`, `yes`, `1`, `"non-empty string"`, `[1,2,3]` → `True`
- `false`, `False`, `no`, `0`, `""`, `[]`, `null` → `False`

**List Fields** (`include`, `exclude`):
- Automatically converted to empty list if missing
- `null` or `false` values converted to empty list

---

## Error Handling

### Exception Hierarchy

#### Configuration Errors
- `FileNotFoundError`: Configuration file not found
- `yaml.YAMLError`: Invalid YAML syntax
- `KeyError`: Missing required configuration keys

#### Network Errors
- `requests.RequestException`: HTTP request failures
- `requests.Timeout`: Request timeout (30 seconds)
- `requests.HTTPError`: HTTP error responses (4xx, 5xx)

#### Processing Errors
- `feedparser.FeedParserDict`: Malformed RSS/XML (handled gracefully)
- `OSError`: File system errors (permissions, disk space)

### Error Recovery

**Conditional Fetch Fallback:**
```python
try:
    content, timestamp = _conditional_fetch(url, since)
except (requests.RequestException, ValueError) as e:
    print(f"Warning: Conditional fetch failed: {e}")
    print("Falling back to regular fetch...")
    # Continue with regular feedparser.parse(url)
```

**Graceful Degradation:**
- Network failures continue processing other feeds
- Malformed RSS processed with available data
- Missing metadata fields use sensible defaults

---

## Performance Characteristics

### HTTP Optimization

**Conditional Requests:**
- Uses `If-Modified-Since` headers to avoid unnecessary downloads
- Handles `304 Not Modified` responses efficiently
- Falls back to regular requests on conditional fetch failures

**Caching Behavior:**
- File timestamps match server `Last-Modified` headers
- Timestamps updated only when new episodes added
- Cache bypass available via `--no-check-modified` flag

### Processing Performance

**Memory Usage:**
- Streaming processing (low memory footprint)
- Append-only logic (preserves existing work)
- No unnecessary data copying

**Benchmarks** (from test suite):
- Large feeds (1,000 episodes): < 10 seconds
- Long keyword lists (10,000 keywords): < 30 seconds
- Typical feeds (50 episodes): < 2 seconds

### Scalability

**Feed Processing:**
- Linear scaling with number of feeds
- Independent processing per feed
- No shared state between feed processing

**Episode Filtering:**
- O(n×m) where n=episodes, m=keywords
- Early exit on exclude matches
- Case-insensitive string matching

---

## Thread Safety

**Current Implementation:**
- **Not thread-safe**: Single-threaded design
- No concurrent processing of feeds
- File I/O not protected by locks

**Future Considerations:**
- Feed processing could be parallelized
- File locking would be needed for concurrent access
- Configuration loading is stateless and thread-safe

---

## Integration Examples

### Python API Usage

```python
from podfeedfilter.config import FeedConfig, load_config
from podfeedfilter.filterer import process_feed

# Direct API usage
config = FeedConfig(
    url="https://example.com/feed.rss",
    output="tech_episodes.xml",
    include=["python", "programming"],
    exclude=["advertisement"],
    title="Python Programming Episodes",
    private=False
)

process_feed(config)

# Configuration file usage
feeds = load_config("feeds.yaml")
for feed in feeds:
    process_feed(feed, no_check_modified=False)
```

### Command Line Integration

```bash
#!/bin/bash
# Cron job example
0 6 * * * cd /path/to/podfeedfilter && python -m podfeedfilter -c production.yaml

# Docker example
docker run --rm -v $(pwd)/feeds.yaml:/feeds.yaml -v $(pwd)/output:/output \
  python:3.10 sh -c "pip install -r requirements.txt && python -m podfeedfilter -c /feeds.yaml"

# GitHub Actions example
- name: Process Podcast Feeds
  run: |
    pip install -r requirements.txt
    python -m podfeedfilter -c .github/feeds.yaml
```

### Advanced Configuration

```yaml
# Production example with multiple sources and complex filtering
feeds:
  # Tech podcast with multiple splits
  - url: "https://changelog.com/podcast/feed"
    output: "changelog_all.xml"
    exclude: ["sponsor", "advertisement"]
    private: true
    
    splits:
      # Python-specific episodes
      - output: "changelog_python.xml"
        title: "Changelog: Python Episodes"
        include: ["python", "django", "flask", "fastapi"]
        private: false  # Public feed
        
      # JavaScript episodes
      - output: "changelog_javascript.xml"
        title: "Changelog: JavaScript Episodes" 
        include: ["javascript", "node", "react", "vue"]
        private: false
        
      # DevOps episodes
      - output: "changelog_devops.xml"
        title: "Changelog: DevOps Episodes"
        include: ["kubernetes", "docker", "devops", "deployment"]
        exclude: ["sponsor", "beginner"]
        
  # Another podcast with bandwidth optimization disabled
  - url: "https://unreliable-host.com/feed.rss"
    output: "unreliable_feed.xml"
    check_modified: false  # Always fetch (unreliable Last-Modified headers)
    include: ["important"]
    private: true
```

This API reference provides comprehensive documentation for all public interfaces in **podfeedfilter**. The package follows clear conventions and provides robust error handling for production use.
